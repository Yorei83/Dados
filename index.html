<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lanzador de Dados</title>

<!-- Fuente estilo D&D -->
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database.js"></script>

<style>
  body {
    font-family: 'MedievalSharp', cursive;
    background: url('https://i.imgur.com/IIK8DXC.jpeg') no-repeat center center fixed;
    background-size: cover;
    color: #f5deb3;
    text-align: center;
    margin:0;
    padding:20px;
  }
  h1 {
    font-size: 2.5rem;
    text-shadow: 2px 2px 5px #000;
    margin-bottom: 20px;
  }
  select, input, button {
    margin: 5px;
    padding: 8px 12px;
    border: 2px solid #d4af37;
    border-radius: 8px;
    background: rgba(0,0,0,0.6);
    color: #f5deb3;
    font-family: 'MedievalSharp', cursive;
    cursor: pointer;
  }
  button:hover { background: rgba(255,215,0,0.3); }
  #chat {
    width: 95%;
    max-width: 600px;
    margin: 20px auto;
    background: rgba(0,0,0,0.7);
    padding: 15px;
    border-radius: 10px;
    text-align: left;
    height: 50vh;
    overflow-y: auto;
    border: 2px solid #d4af37;
  }
  .msg { margin-bottom:10px; padding:5px; border-bottom:1px solid #8b4513; word-wrap: break-word;}
  @media (max-width:768px){
    #chat{height:60vh;}
    .controls{flex-direction:column;gap:8px;}
  }
</style>
</head>
<body>
<h1>Lanzador de Dados</h1>

<div class="controls" style="display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:10px;">
  <label>Cantidad:
    <input type="number" id="cantidad" min="1" value="1" style="width:60px;">
  </label>
  <label>Tipo:
    <select id="tipo">
      <option value="2">d2</option><option value="4">d4</option><option value="6">d6</option>
      <option value="8">d8</option><option value="10">d10</option><option value="12">d12</option>
      <option value="20">d20</option><option value="100">d100</option>
    </select>
  </label>
  <button id="tirar">Lanzar dados</button>
</div>

<div style="margin-top:10px;">
  <button id="especial">4d6 (3 mÃ¡s altos)</button>
  <button id="limpiarTodo">LIMPIAR TODO</button>
</div>

<div id="chat"></div>

<script>
  // ðŸ”¹ CONFIGURACIÃ“N FIREBASE
  const firebaseConfig = {
    apiKey: "AIzaSyAtmCLh41-kP3Duzz7vuUDgwo7KtnsJgAs",
    authDomain: "dados-en-vivo.firebaseapp.com",
    databaseURL: "https://dados-en-vivo-default-rtdb.europe-west1.firebasedatabase.app/",
    projectId: "dados-en-vivo",
    storageBucket: "dados-en-vivo.firebasestorage.app",
    messagingSenderId: "755216472287",
    appId: "1:755216472287:web:36c0bdd712c5feec4fb16a"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ðŸ”¹ PIDE NOMBRE DE USUARIO AL ENTRAR
  let usuario = "";
  while(!usuario){
    usuario = prompt("Introduce tu nombre para identificar las tiradas:") || "";
    usuario = usuario.trim();
  }

  const chat = document.getElementById("chat");

  function tirarDados(lados, cantidad){
    const res = [];
    for(let i=0;i<cantidad;i++) res.push(Math.floor(Math.random()*lados)+1);
    return res;
  }

  function colorearNumero(n){
    if(n === 1) return `<span style="color:red;font-weight:bold">${n}</span>`;
    if(n === 6 || n === 20) return `<span style="color:green;font-weight:bold">${n}</span>`;
    return n;
  }

  function enviarTirada(dados, total){
    db.ref("tiradas").push({
      usuario: usuario,
      dados: dados,
      total: total,
      timestamp: Date.now()
    });
  }

  function mostrarTirada(data){
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `${data.usuario}: [${data.dados.map(colorearNumero).join(", ")}] Total: ${data.total}`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  // Escucha en tiempo real
  db.ref("tiradas").limitToLast(50).on("child_added", snap => {
    const data = snap.val();
    mostrarTirada(data);
  });

  document.getElementById("tirar").onclick = ()=>{
    const lados = parseInt(document.getElementById("tipo").value);
    const cant = parseInt(document.getElementById("cantidad").value);
    const res = tirarDados(lados, cant);
    const suma = res.reduce((a,b)=>a+b,0);
    enviarTirada(res, suma);
  };

  document.getElementById("especial").onclick = ()=>{
    const res = tirarDados(6,4);
    const top3 = [...res].sort((a,b)=>b-a).slice(0,3);
    const suma = top3.reduce((a,b)=>a+b,0);
    // enviamos los 4 dados pero mostramos que la suma es de los 3 mayores
    enviarTirada(res, suma + " (suma de los 3 mÃ¡s altos)");
  };

  document.getElementById("limpiarTodo").onclick = ()=>{
    db.ref("tiradas").remove();
    chat.innerHTML = "";
  };
</script>
</body>
</html>