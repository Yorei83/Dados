
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lanzador de Dados</title>
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'MedievalSharp', cursive;
    background: url('https://i.imgur.com/IIK8DXC.jpeg') no-repeat center center fixed;
    background-size: cover;
    color: #f5deb3;
    text-align: center;
    padding: 20px;
    margin:0;
    transition: all 0.3s ease;
  }
  select, input, button {
    margin: 5px;
    padding: 8px 12px;
    border: 3px solid #ffd700;
    border-radius: 10px;
    background: rgba(0,0,0,0.6);
    color: #f5deb3;
    font-family: 'MedievalSharp', cursive;
    cursor: pointer;
    box-shadow: 0 0 10px #ffd700;
  }
  button:hover { background: rgba(255,215,0,0.3); box-shadow: 0 0 20px #ffd700; }
  #chat {
    width: 90%;
    max-width: 600px;
    margin: 20px auto;
    background: rgba(0,0,0,0.7);
    padding: 15px;
    border-radius: 12px;
    text-align: left;
    height: 300px;
    overflow-y: auto;
    border: 3px solid #ffd700;
    box-shadow: inset 0 0 10px #000;
    transition: all 0.3s ease;
  }
  .msg { margin-bottom:10px; padding:5px; border-bottom:1px solid #8b4513; word-wrap: break-word;}
  .propio { color: #ffd700; }
  h1 {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 2.5rem;
    text-shadow: 2px 2px 5px #000;
    flex-wrap: wrap;
  }
  .dado-container { position: relative; display: inline-block; }
  .dado { width:60px; height:60px; fill:#8b0000; stroke:#ffd700; stroke-width:2; filter: drop-shadow(0 0 10px gold); }
  #dadoNum { font-size:32px; fill:#ffd700; }

  /* Botones pantalla completa */
  #fullscreenBtn, #exitFullscreenBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 12px 16px;
    font-size: 1.2rem;
    border-radius: 50%;
    border: 2px solid #ffd700;
    background: rgba(0,0,0,0.7);
    color: #f5deb3;
    cursor: pointer;
    box-shadow: 0 0 10px #ffd700;
    z-index: 1000;
    transition: background 0.2s, transform 0.2s;
  }
  #fullscreenBtn:hover, #exitFullscreenBtn:hover { background: rgba(255,215,0,0.3); transform: scale(1.1); }
  #exitFullscreenBtn { display: none; }

  /* Responsive */
  @media (max-width: 768px) { 
    h1 { font-size: 2rem; } 
    .dado { width:50px; height:50px; } 
    #chat { height: 250px; } 
    select, input, button { padding: 6px 10px; font-size: 0.9rem; } 
  }
  @media (max-width: 480px) { 
    h1 { font-size: 1.5rem; gap:5px; } 
    .dado { width:40px; height:40px; } 
    #chat { height: 200px; } 
    select, input, button { padding: 5px 8px; font-size: 0.8rem; } 
  }
  @media (min-width: 481px) and (max-width: 1024px) { 
    h1 { font-size: 2rem; gap:8px; } 
    .dado { width:55px; height:55px; } 
    #chat { height: 280px; } 
  }

  /* Pantalla completa: escalar chat y controles */
  body.fullscreen #chat { height: 60vh; max-width: 90vw; }
  body.fullscreen select, body.fullscreen input, body.fullscreen button { font-size: 1.1rem; padding: 10px 16px; }
  body.fullscreen h1 { font-size: 3rem; }
  body.fullscreen .dado { width:80px; height:80px; }
</style>
</head>
<body>
<h1>
  <div class="dado-container">
    <svg class="dado" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <polygon points="32,2 62,16 54,58 10,58 2,16"/>
      <text id="dadoNum" x="32" y="40" text-anchor="middle" font-family="MedievalSharp, Arial" font-weight="bold">20</text>
    </svg>
  </div>
  Lanzador de Dados
</h1>

<div>
  <label>Nombre de usuario:
    <input type="text" id="usuario" placeholder="Tu nombre">
  </label>
</div>

<label>Tipo de dado:
<select id="tipo">
  <option value="2">d2</option><option value="4">d4</option><option value="6">d6</option>
  <option value="8">d8</option><option value="10">d10</option><option value="12">d12</option>
  <option value="20">d20</option><option value="100">d100</option>
</select></label>

<label>Cantidad:
<input type="number" id="cantidad" min="1" value="1"></label>

<button id="tirar">Tirar</button>
<button id="especial">4d6 (3 más altos)</button>

<div style="margin-top:10px;">
  <button id="limpiarPropio">Limpiar mis tiradas</button>
  <button id="limpiarTodo">Limpiar TODO</button>
</div>

<div id="chat"></div>

<!-- Botones pantalla completa -->
<button id="fullscreenBtn" title="Pantalla completa">⛶</button>
<button id="exitFullscreenBtn" title="Salir pantalla completa">❎</button>

<script>
const chat = document.getElementById("chat");

// Funciones dados
function tirarDados(lados, cantidad){
  let res=[];
  for(let i=0;i<cantidad;i++) res.push(Math.floor(Math.random()*lados)+1);
  return res;
}
function colorearNumero(n){
  if(n===1) return `<span style="color:red;font-weight:bold">${n}</span>`;
  if(n===6 || n===20) return `<span style="color:green;font-weight:bold">${n}</span>`;
  return n;
}

// Animación en el chat
function animarChatMultiple(usuario, numerosFinales, sumaFinal, topIndices=null){
  const div=document.createElement("div");
  div.className="msg propio"; div.dataset.usuario=usuario;
  chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
  const vueltas=15, interval=50; let cuenta=0;
  const anim=setInterval(()=>{
    let numeros;
    if(topIndices){
      // Para 4d6 animamos cada dado
      numeros = numerosFinales.map(n=>Math.floor(Math.random()*6)+1);
      const sumaAnim = topIndices.reduce((acc,i)=>acc+numeros[i],0);
      const display = numeros.map((val,i)=>{
        if(topIndices.includes(i)) return `<span style="color:green;font-weight:bold">${val}</span>`;
        return val;
      });
      div.innerHTML = `${usuario}: [${display.join(", ")}] Suma de los 3 más altos: ${sumaAnim}`;
    } else {
      numeros = numerosFinales.map(n=>Math.floor(Math.random()*n)+1);
      const sumaAnim = numeros.reduce((a,b)=>a+b,0);
      div.innerHTML = `${usuario}: [${numeros.map(colorearNumero).join(", ")}] Total: ${sumaAnim}`;
    }
    cuenta++;
    if(cuenta>=vueltas){
      clearInterval(anim);
      if(topIndices){
        const displayFinal = numerosFinales.map((val,i)=>{
          if(topIndices.includes(i)) return `<span style="color:green;font-weight:bold">${val}</span>`;
          return val;
        });
        div.innerHTML = `${usuario}: [${displayFinal.join(", ")}] Suma de los 3 más altos: ${sumaFinal}`;
      } else {
        div.innerHTML = `${usuario}: [${numerosFinales.map(colorearNumero).join(", ")}] Total: ${sumaFinal}`;
      }
    }
    chat.scrollTop=chat.scrollHeight;
  },interval);
}

// Botones dados
document.getElementById("tirar").onclick=()=>{
  const user=document.getElementById("usuario").value.trim()||"Anon";
  const lados=parseInt(document.getElementById("tipo").value);
  const cant=parseInt(document.getElementById("cantidad").value);
  const res=tirarDados(lados,cant); const suma=res.reduce((a,b)=>a+b,0);
  animarChatMultiple(user,res,suma);
};

document.getElementById("especial").onclick = () => {
  const user = document.getElementById("usuario").value.trim() || "Anon";
  const res = tirarDados(6,4);
  const sortedIndices = res.map((v,i)=>[v,i]).sort((a,b)=>b[0]-a[0]).map(pair=>pair[1]);
  const top3Indices = sortedIndices.slice(0,3);
  const suma = top3Indices.reduce((acc,i)=>acc+res[i],0);
  animarChatMultiple(user,res,suma,top3Indices);
};

document.getElementById("limpiarPropio").onclick=()=>{
  const user=document.getElementById("usuario").value.trim()||"Anon";
  [...chat.children].forEach(msg=>{ if(msg.dataset.usuario===user) msg.remove(); });
};
document.getElementById("limpiarTodo").onclick=()=>{ chat.innerHTML=""; };

// Pantalla completa
const fullscreenBtn=document.getElementById("fullscreenBtn");
const exitFullscreenBtn=document.getElementById("exitFullscreenBtn");
fullscreenBtn.addEventListener("click", ()=>{ document.documentElement.requestFullscreen(); });
exitFullscreenBtn.addEventListener("click", ()=>{ document.exitFullscreen(); });
document.addEventListener("fullscreenchange", ()=>{
  if(document.fullscreenElement){ 
    fullscreenBtn.style.display="none"; 
    exitFullscreenBtn.style.display="block"; 
    document.body.classList.add("fullscreen");
  } else { 
    fullscreenBtn.style.display="block"; 
    exitFullscreenBtn.style.display="none"; 
    document.body.classList.remove("fullscreen");
  }
});
</script>
</body>
</html>
